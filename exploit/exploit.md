## Exploit explanation

An entity named "total_number_of_registered_entities" will be accepted as registered by the function `is_entity_registired`. This opens the door for: 
- unexpected bugs
- a malicious entity can use "total_number_of_registered_entities" as its name. Then it may be able to use some of the network's privileges

The reason why this happens is because the StakNet OS stores a 0-argument variable with name `variable_name` at the cell `sn_keccak256(variable_name)` [[1]](https://docs.starknet.io/docs/Contracts/contract-storage#storage-variables) (here `sn_keccak256` means StarkNet's version of the Keccak256 hash function). Hence, as long as `total_number_of_registered_entities` is more than 0, we have `storage_read(sn_keccak(num_entitties_storage)) > 0`, and so `is_entity_registerd(hash_of_entity_name) = 1`.

Similarly, for each 0-argument storage variable `foo` in the contract, an entity with name "foo" will pass as registered in the L2 contract, as long as `foo` stores a nonzero value.

## Bug test

The script `test_exploit.py` contains a test that checks that this bug occurs.

## Possible patch

Instead of storing the entity information in the hash of the entity's name, use a storage variable that maps entity names (or the `sn_keccak256` hashes of the names) to their corresponding instance of the struct EntityInfo. A similar attack now is not possible because now an entity with name `x` has its information stored in `pedersen_hash(sn_keccak256("storage_variable_name"), "x")` [[1]](https://docs.starknet.io/docs/Contracts/contract-storage#storage-variables) (where strings are interpreted as felts).

This is perhaps the most natural way of writing the L2 contract to begin with. However as discussed in the README, it is reasonable to think that some developer would choose the bugged version due to it being slightly more efficient (because the keccak hashes are already computed, and writing/reading storage variables with arguments requires the computation of extra hashes) and because the bugged version is potentially more consistent with how the L1 contract is written.

